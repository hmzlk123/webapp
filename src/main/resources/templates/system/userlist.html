<!DOCTYPE html>
<html xmlns:th= "http://www.thymeleaf.org" lang="en">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>用户列表管理</title>

		<meta name="description" content="Static &amp; Dynamic Tables" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}" />
		<!-- <link rel="stylesheet" th:href="@{/assets/font-awesome/4.5.0/css/font-awesome.min.css}" /> -->
		<link rel="stylesheet" th:href="@{/assets/font-awesome/4.5.0/css/font-awesome.min.css}">
	
		<!-- text fonts -->
		<link rel="stylesheet" th:href="@{/assets/css/fonts.googleapis.com.css}" />

		<!-- ace styles -->
		<link rel="stylesheet" th:href="@{/assets/css/ace.min.css}" class="ace-main-stylesheet" id="main-ace-style" />

		<link rel="stylesheet" th:href="@{/assets/css/ace-skins.min.css}" />
		<link rel="stylesheet" th:href="@{/assets/css/ace-rtl.min.css}" />

		<!-- ace settings handler -->
		<script th:src="@{/assets/js/ace-extra.min.js}"></script>
		<base th:href="@{${basehref}}"/>
	</head>

	<body class="no-skin">
		<div style="background-color: #FFF;overflow-x: hidden; padding: 2px;">
			<div class="row">
				<div class="col-xs-12">
					<!-- PAGE CONTENT BEGINS -->
					<div class="row">
						<div class="col-xs-12">
							<h3 class="header smaller lighter blue">用户列表</h3>
							
							<div class="clearfix">
								<div class="pull-right tableTools-container" ></div>
							</div>

							<div class="table-header">
								Results for "Latest Registered Domains"
							</div>

							<!-- div.table-responsive -->

							<!-- div.dataTables_borderWrap -->
							<div>
								<table id="dynamic-table" class="table table-striped table-bordered table-hover">
									<thead>
										<tr>
<!-- 											<th class="center">
												<label class="pos-rel">
													<input type="checkbox" class="ace" />
													<span class="lbl"></span>
												</label>
											</th> -->
											<th class="colhidden">用户编号</th>
											<th class="colhidden">是否禁用</th>
											<th style="width: 5%">详细</th>
											<th style="width: 15%">用户名</th>
											<th style="width: 15%">姓名</th>
											<th style="width: 15%">部门</th>
											<th style="width: 8%">性别</th>
											<th style="width: 15%">邮箱</th>
											<th style="width: 15%">状态</th>
											<th>操作</th>
										</tr>
									</thead>

									<tbody>
									</tbody>
								</table>
								
								<div id="table-detail" class="table-detail" style="display: none">
									<div class="row">
										<div class="col-xs-12 col-sm-2">
											<div class="text-center">
												<img height="150" class="thumbnail inline no-margin-bottom" alt="Domain Owner's Avatar" src="assets/images/avatars/profile-pic.jpg" />
												<br />
												<div class="width-80 label label-info label-xlg arrowed-in arrowed-in-right">
													<div class="inline position-relative">
														<a class="user-title-label" href="#">
															<i class="ace-icon fa fa-circle light-green"></i>
															&nbsp;
															<span class="white">Alex M. Doe</span>
														</a>
													</div>
												</div>
											</div>
										</div>

										<div class="col-xs-12 col-sm-7">
											<div class="space visible-xs"></div>

											<div class="profile-user-info profile-user-info-striped">
												<div class="profile-info-row">
													<div class="profile-info-name"> Username </div>

													<div class="profile-info-value">
														<span>alexdoe</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> Location </div>

													<div class="profile-info-value">
														<i class="fa fa-map-marker light-orange bigger-110"></i>
														<span>Netherlands, Amsterdam</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> Age </div>

													<div class="profile-info-value">
														<span>38</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> Joined </div>

													<div class="profile-info-value">
														<span>2010/06/20</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> Last Online </div>

													<div class="profile-info-value">
														<span>3 hours ago</span>
													</div>
												</div>

												<div class="profile-info-row">
													<div class="profile-info-name"> About Me </div>

													<div class="profile-info-value">
														<span>Bio</span>
													</div>
												</div>
											</div>
										</div>

										<div class="col-xs-12 col-sm-3">
											<div class="space visible-xs"></div>
											<h4 class="header blue lighter less-margin">Send a message to Alex</h4>

											<div class="space-6"></div>

											<form>
												<fieldset>
													<textarea class="width-100" placeholder="Type something…"></textarea>
												</fieldset>

												<div class="hr hr-dotted"></div>

												<div class="clearfix">
													<label class="pull-left">
														<input type="checkbox" class="ace" />
														<span class="lbl"> Email me a copy</span>
													</label>

													<button class="pull-right btn btn-sm btn-primary btn-white btn-round" type="button">
														Submit
														<i class="ace-icon fa fa-arrow-right icon-on-right bigger-110"></i>
													</button>
												</div>
											</form>
										</div>
										</div>
									</div>
								</div>
						</div>
					</div>
					<!-- PAGE CONTENT ENDS -->
				</div><!-- /.col -->
			</div><!-- /.row -->
		<!-- /.page-content -->

		</div>
	
		<script th:src="@{/assets/js/jquery-2.1.4.min.js}"></script>
		<script type="text/javascript">
			if('ontouchstart' in document.documentElement) document.write("<script th:src='@{/assets/js/jquery.mobile.custom.min.js}'>"+"<"+"/script>");
		</script>
		<script th:src="@{/assets/js/bootstrap.min.js}"></script>

		<!-- page specific plugin scripts -->
		<script th:src="@{/assets/js/jquery.dataTables.min.js}"></script>
		<script th:src="@{/assets/js/jquery.dataTables.bootstrap.min.js}"></script>
		<script th:src="@{/assets/js/dataTables.buttons.min.js}"></script>
		<script th:src="@{/assets/js/buttons.flash.min.js}"></script>
		<script th:src="@{/assets/js/buttons.html5.min.js}"></script>
		<script th:src="@{/assets/js/buttons.print.min.js}"></script>
		<script th:src="@{/assets/js/buttons.colVis.min.js}"></script>
		<script th:src="@{/assets/js/dataTables.select.min.js}"></script>
		<!-- ace scripts -->
		<script th:src="@{/assets/js/ace-elements.min.js}"></script>
		<script th:src="@{/assets/js/ace.min.js}"></script>

		<!-- inline scripts related to this page -->
		<script type="text/javascript">			
			function retrieveData( sSource, aoData, fnCallback ) {  
		        //查询条件称加入参数数组     
		        $.ajax( {     
		            type: "POST",
		            url: sSource,   
		            dataType:"json",  
		            data: "jsonParam="+JSON.stringify(aoData),  
		            success: function(data) {   
		               //$("#url_sortdata").val(data.aaData);  
		                fnCallback(data); //服务器端返回的对象的returnObject部分是要求的格式     
		                
		            }
		        });    
		    } 
	
			function delUser(obj){
				var tableDatail = $('#table-detail').clone();
				var thisTr = $(obj).closest('tr');
				var nextTr = $(obj).closest('tr').next();
				if(nextTr.hasClass('detail-row')){
					thisTr.next().remove();
				}else{
					$(obj).closest('tr').after('<tr class="detail-row open"><td colspan="8"></td></tr>');
					$(obj).closest('tr').next().find('td').append(tableDatail);
					$(obj).closest('tr').next().find('.table-detail').attr('style','display:block');
				}
				
				$(obj).find(ace.vars['.icon']).toggleClass('fa-angle-double-down').toggleClass('fa-angle-double-up');
			}
			
			function changeUserEnable(userId,enabled){
				var data = {};
				data.userId = userId;
				data.enabled = enabled;
				$.ajax( {     
		            type: "post",
		            url: "um/changeenable",
		            dataType:"json", 
		            contentType:"application/json",
		            data:JSON.stringify(data),
		            success: function(data) {   
		            	jQuery('#dynamic-table').dataTable().fnDraw(false);   
		            },
		            error:function(result){
		            	alert(result);
		            }
		        });    		
			}
			
			jQuery(function($) {
		
				//initiate dataTables plugin
				var myTable = 
				$('#dynamic-table')
				//.wrap("<div class='dataTables_borderWrap' />")   //if you are applying horizontal scrolling (sScrollX)
				.DataTable( {
					bAutoWidth: false,
					"aoColumns": [
/* 					  { "bSortable": false,
					  	"render": function (data, type) {
		                    return "<label class='pos-rel'><input type='checkbox' class='ace'/><span class='lbl'></span></label>" ;
		               	}
					  }, */
					  {	
						 "mDataProp": "userId",
						 "visible": false  
					  },
					  {	
						 "mDataProp": "enabled",
						 "visible": false  
					  },
					  {	
						"bSortable": false,
						"render": function (data, type) {
							var style = "<div class='action-buttons'>"+
										"<a href='javascript:;'  class='green bigger-140 show-details-btn' onclick='delUser(this)' title='Show Details'>"+		
										"<i class='ace-icon fa fa-angle-double-down'></i>"+
										"<span class='sr-only'>Details</span>"+
										"</b>"+
										"</div>";
		                    return style;
		               	}
					  },
					  { 
						"mDataProp": "userName"
					  },
					  { 
						"mDataProp": "name",
						"bSortable": false 
					  },
					  { 
						"mDataProp": "department",
						"bSortable": false,
						"defaultContent": ""
					  },
					  { 
						"mDataProp": "sex",
						"render": function (data, type) {
		                    return data==1?'男':'女' ;
		               	},
						"bSortable": false   
					  },
					  { 
						"mDataProp": "email",
						"defaultContent": "",
						"bSortable": false 
					  },
					  { 
						"mDataProp": "locked",
						"render": function (data,type,full,row) {
							var str = "<span class='label label-info'>Normal</span>";
							var lockedstyle = "";
							var enabledstyle = "";
							if(data == 1){
								lockedstyle = "<span class='label label-warning arrowed-right'>Locked</span>";
								str = "";
							}
							if(full.enabled == 0){
								enabledstyle = "<span class='label label-danger arrowed-in'>Disable</span>";
								str = "";
							}
													
		                    return lockedstyle+enabledstyle+str ;
		               	}
							
					  },
					  { 

				
						"mDataProp": "locked",
						"render": function (data,type,full,row) {
							var lockclass ="";
							var enableclass = "fa fa-ban";
							if(data == 1)	
								lockclass = "fa fa-lock-open";
								
							if(full.enabled == 1)
								enableclass = "fa fa-ban";
							else
								enableclass = "fa fa-ban green";
							
							var div = 
							"<div class='hidden-sm hidden-xs action-buttons'>"+
							"<a class='green' href='#'><i class='ace-icon fa fa-search-plus bigger-130'></i></a>"+
							"<a class='blue' href='#'><i class='ace-icon fa fa-user-edit bigger-130'></i></a>"+
							"<a class='orange' href='javascript:;' onclick='delUser(\""+full.userId+"\")'><i class='ace-icon fa fa-trash  bigger-130'></i></a>"+
							"<a class='red' href='javascript:;' onclick='changeUserEnable(\""+full.userId+"\",\""+full.enabled+"\")'><i class='ace-icon "+enableclass+" bigger-130'></i></a>"+
							"<a class='dark' href='#'><i class='ace-icon "+lockclass+" bigger-130'></i></a>"+						
							"</div>";				
		                    return div ;
		               	}
					  }
					],
					"columnDefs": [
					    /* {className: "center", "targets": [0]}, */
					    {className: "colhidden", "targets": [0]},
					    {className: "colhidden", "targets": [1]},
					    {className: "center", "targets": [2]}
					],
					"aaSorting": [
					
					],
					
					"lengthMenu": [
			            [5, 10, 20],
			            [5, 10, 20] // 更改每页显示记录数
			        ],
			        //"bServerSide": true,
			        "pagingType": "full_numbers",  	//分页样式：simple,simple_numbers,full,full_numbers
			        "sAjaxSource": "um/userlist",
			        "sServerMethod" : "POST",
			        "fnServerData":retrieveData,		//
			        //"bProcessing" : true, 			//DataTables载入数据时，是否显示‘进度’提示  
			        "bServerSide" : true, 				//是否启动服务器端数据导入
					//"sScrollY": "200px",
					//"bPaginate": false,
			
					//"sScrollX": "100%",
					//"sScrollXInner": "120%",
					//"bScrollCollapse": true,
					//Note: if you are applying horizontal scrolling (sScrollX) on a ".table-bordered"
					//you may want to wrap the table inside a "div.dataTables_borderWrap" element
			
					//"iDisplayLength": 50
					"language": {
			            "lengthMenu": "  _MENU_ 条数据",
			            "emptyTable": "表格中没有数据~",
			            "info": "显示 _START_ 到 _END_ 条数据，共 _TOTAL_ 条数据",
			            "infoEmpty": "没有数据~",
			            "infoFiltered": "(在 _MAX_ 条数据中查询)",
			            "lengthMenu": "显示 _MENU_ 条数据",
			            "search": "查询:",
			            "zeroRecords": "没有找到对应的数据",
			            "select": {
			                "rows": "，%d 行 被选择"
			            },
			            "paginate": {
			                "previous":"上一页",
			                "next": "下一页",
			                "last": "末页",
			                "first": "首页"
			            }
			        },

					select: {
						style: 'single'
					}
		
			    } );
				
				
				$.fn.dataTable.Buttons.defaults.dom.container.className = 'dt-buttons btn-overlap btn-group btn-overlap';
				
				new $.fn.dataTable.Buttons( myTable, {
					buttons: [
						
						  {
							"text": "<i class='glyphicon glyphicon-plus bigger-110 green'></i> <span class='hidden'>Show/hide columns</span>",
							"className": "btn btn-white btn-primary btn-bold",
							action: function ( e, dt, node, config ) {
						        alert(111);
						    }
						  },
					  {
						"extend": "colvis",
						"text": "<i class='fa fa-search bigger-110 blue'></i> <span class='hidden'>Show/hide columns</span>",
						"className": "btn btn-white btn-primary btn-bold",
						columns: ':not(.center):not(:last):not(.colhidden)'
					  },
					  {
						"extend": "copy",
						"text": "<i class='fa fa-copy bigger-110 pink'></i> <span class='hidden'>Copy to clipboard</span>",
						"className": "btn btn-white btn-primary btn-bold"
					  },
					  {
						"extend": "csv",
						"text": "<i class='fa fa-database bigger-110 orange'></i> <span class='hidden'>Export to CSV</span>",
						"className": "btn btn-white btn-primary btn-bold"
					  },
					  {
						"extend": "excel",
						"text": "<i class='fa fa-file-excel-o bigger-110 green'></i> <span class='hidden'>Export to Excel</span>",
						"className": "btn btn-white btn-primary btn-bold"
					  },
					  {
						"extend": "pdf",
						"text": "<i class='fa fa-file-pdf-o bigger-110 red'></i> <span class='hidden'>Export to PDF</span>",
						"className": "btn btn-white btn-primary btn-bold"
					  },
					  {
						"extend": "print",
						"text": "<i class='fa fa-print bigger-110 grey'></i> <span class='hidden'>Print</span>",
						"className": "btn btn-white btn-primary btn-bold",
						autoPrint: false,
						message: 'This print was produced using the Print button for DataTables'
					  }
					]
				} );
				myTable.buttons().container().appendTo( $('.tableTools-container') );
				
				//style the message box
				var defaultCopyAction = myTable.button(2).action();
				myTable.button(2).action(function (e, dt, button, config) {
					defaultCopyAction(e, dt, button, config);
					$('.dt-button-info').addClass('gritter-item-wrapper gritter-info gritter-center white');
				});
				
				
				var defaultColvisAction = myTable.button(1).action();
				myTable.button(1).action(function (e, dt, button, config) {
					
					defaultColvisAction(e, dt, button, config);
					
					if($('.dt-button-collection > .dropdown-menu').length == 0) {
						$('.dt-button-collection')
						.wrapInner('<ul class="dropdown-menu dropdown-light dropdown-caret dropdown-caret" style="left:40px;" />')
						.find('a').attr('href', '#').wrap("<li />")
					}
					$('.dt-button-collection').appendTo('.tableTools-container .dt-buttons')
				});
			
				////
			
				setTimeout(function() {
					$($('.tableTools-container')).find('a.dt-button').each(function() {
						var div = $(this).find(' > div').first();
						if(div.length == 1) div.tooltip({container: 'body', title: div.parent().text()});
						else $(this).tooltip({container: 'body', title: $(this).text()});
					});
				}, 500);
				
/*  				setTimeout(function() {
					$($('.show-details-btn')).on('click',function(){
						var tableDatail = $('#table-detail').clone();
						var thisTr = $(this).closest('tr');
						var nextTr = $(this).closest('tr').next();
						if(nextTr.hasClass('detail-row')){
							thisTr.next().remove();
						}else{
							$(this).closest('tr').after('<tr class="detail-row open"><td colspan="8"></td></tr>');
							$(this).closest('tr').next().find('td').append(tableDatail);
							$(this).closest('tr').next().find('.table-detail').attr('style','display:block');
						}
						
						$(this).find(ace.vars['.icon']).toggleClass('fa-angle-double-down').toggleClass('fa-angle-double-up');
					});
				}, 500);  */
				
				$(document).on('click', '#dynamic-table .dropdown-toggle', function(e) {
					e.stopImmediatePropagation();
					e.stopPropagation();
					e.preventDefault();
				});
				
				
				
				//And for the first simple table, which doesn't have TableTools or dataTables
				//select/deselect all rows according to table header checkbox
				var active_class = 'active';
				
			})
		</script>
	</body>
</html>
